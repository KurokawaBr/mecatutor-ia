import streamlit as st
import pandas as pd
import os
import sys

def resource_path(relative_path):
    """
    Retorna o caminho absoluto do arquivo, 
    compat√≠vel com execu√ß√£o direta e com PyInstaller.
    """
    try:
        # Quando est√° rodando no PyInstaller, _MEIPASS aponta para a pasta tempor√°ria de extra√ß√£o
        base_path = sys._MEIPASS  # type: ignore
    except Exception:
        # No modo normal, retorna a pasta onde est√° o app.py
        base_path = os.path.dirname(os.path.abspath(__file__))
    return os.path.join(base_path, relative_path)

st.set_page_config(page_title="MecaTutorIA", page_icon="ü§ñ")

st.title("üíß Mec√¢nica dos Fluidos - Munson (4¬™ Edi√ß√£o)")
st.markdown("---")

menu = ["Resumos dos Cap√≠tulos", "Exerc√≠cios Resolvidos", "Sobre"]
choice = st.sidebar.radio("Menu", menu)

if choice == "Resumos dos Cap√≠tulos":
    st.header("üìö Resumos dos Cap√≠tulos")

    cap = st.selectbox("Escolha o cap√≠tulo", [
        "Cap√≠tulo 1 ‚Äì Introdu√ß√£o e Conceitos Iniciais",
        "Cap√≠tulo 2 ‚Äì Est√°tica dos Fluidos",
        "Cap√≠tulo 3 ‚Äì Din√¢mica dos Fluidos (Bernoulli)",
        "Cap√≠tulo 8 ‚Äì Escoamento Viscoso em Condutos"
    ])

    if cap == "Cap√≠tulo 1 ‚Äì Introdu√ß√£o e Conceitos Iniciais":
        st.subheader("Cap√≠tulo 1 ‚Äì Introdu√ß√£o e Conceitos Iniciais")
        st.markdown(r"""
### O que √© um fluido?
Um fluido √© uma subst√¢ncia que se deforma continuamente sob a√ß√£o de uma tens√£o de cisalhamento, n√£o importando o qu√£o pequena seja essa for√ßa. Inclui l√≠quidos e gases.

#### Principais propriedades e f√≥rmulas:
- **Densidade ($\rho$):**
  $$
  \rho = \frac{m}{V}
  $$
  Onde:
  - $\rho$ = densidade do fluido ($kg/m^3$)
  - $m$ = massa ($kg$)
  - $V$ = volume ($m^3$)

- **Peso espec√≠fico ($\gamma$):**
  $$
  \gamma = \rho g
  $$
  Onde:
  - $\gamma$ = peso espec√≠fico ($N/m^3$)
  - $\rho$ = densidade ($kg/m^3$)
  - $g$ = acelera√ß√£o da gravidade ($9,81\, m/s^2$)

- **Viscosidade din√¢mica ($\mu$):** 
  Mede a resist√™ncia do fluido ao escoamento. 
  - Unidade: $Pa \cdot s$ ou $kg/(m \cdot s)$

- **Viscosidade cinem√°tica ($\nu$):**
  $$
  \nu = \frac{\mu}{\rho}
  $$
  Onde:
  - $\nu$ = viscosidade cinem√°tica ($m^2/s$)
  - $\mu$ = viscosidade din√¢mica ($Pa \cdot s$)
  - $\rho$ = densidade ($kg/m^3$)

- **Press√£o ($P$):**
  $$
  P = \frac{F}{A}
  $$
  Onde:
  - $P$ = press√£o ($Pa$)
  - $F$ = for√ßa normal √† superf√≠cie ($N$)
  - $A$ = √°rea ($m^2$)
""")

        # Dados da Tabela 1.5
        st.subheader("Tabela 1.5 - Propriedades F√≠sicas de Alguns L√≠quidos")
        tab1_5 = {
            "L√≠quido": ["Tetracloreto de Carbono", "√Ålcool Et√≠lico", "Gasolina", "Glicerina", "Merc√∫rio", "√ìleo SAE 30", "√Ågua do mar", "√Ågua"],
            "Temperatura (¬∞C)": [20, 20, 15.6, 20, 20, 15.6, 15.6, 15.6],
            "Massa Espec√≠fica (kg/m¬≥)": [1590, 789, 680, 1260, 13600, 912, 1030, 999],
            "Viscosidade Din√¢mica Œº (N¬∑s/m¬≤)": [9.58E-4, 1.19E-3, 3.1E-4, 1.50E-1, 1.57E-3, 3.8E-1, 1.2E-3, 1.12E-3],
            "Tens√£o Superficial œÉ (N/m)": [2.69E-2, 2.28E-2, 2.02E-2, 6.33E-2, 4.66E-1, 3.6E-2, 7.34E-2, 7.34E-2],
            "Press√£o de Vapor p_v (N/m¬≤ abs)": [1.3E+4, 5.9E+3, 5.5E+4, 1.4E+2, 1.6E+2, 1.5E+2, 1.77E+3, 1.77E+3],
            "Compressibilidade E_s (N/m¬≤)": [1.31E+9, 1.06E+9, 8.2E+8, 4.52E+9, 2.85E+10, 1.5E+9, 2.34E+9, 2.15E+9]
        }
        
        df_liquidos = pd.DataFrame(tab1_5)  
        st.dataframe(df_liquidos)

        st.subheader("Tabela 1.6 - Propriedades F√≠sicas de Alguns Gases")
        # Dados da Tabela 1.6
        tab1_6 = {
            "G√°s": ["Ar (padr√£o)", "Di√≥xido de Carbono", "H√©lio", "Hidrog√™nio", "Metano (g√°s natural)", "Nitrog√™nio", "Oxig√™nio"],
            "Temperatura (¬∞C)": [15, 20, 20, 20, 0, 20, 20],
            "Massa Espec√≠fica (kg/m¬≥)": [1.23E+0, 1.83E+0, 1.66E-1, 8.38E-2, 7.16E-1, 1.16E+0, 1.33E+0],
            "Viscosidade Din√¢mica Œº (N¬∑s/m¬≤)": [1.79E-5, 1.47E-5, 1.96E-5, 8.84E-6, 1.10E-5, 1.76E-5, 2.04E-5],
            "Constante do G√°s R (J/kg¬∑K)": [2.869E+2, 1.889E+2, 2.077E+3, 4.124E+3, 5.183E+2, 2.968E+2, 2.598E+2],
            "Raz√£o de Calores Espec√≠ficos k": [1.40, 1.30, 1.66, 1.41, 1.31, 1.40, 1.40]
        }
        
        df_gases = pd.DataFrame(tab1_6)  
        st.dataframe(df_gases)

        st.markdown(r"""
---

### Exemplos Pr√°ticos

**Exemplo 1: C√°lculo da densidade**
> Um corpo de massa $500\,g$ ocupa um volume de $0,0005\,m^3$. Qual √© a sua densidade?

$\rightarrow$ Convertendo a massa para $kg$:  $m = \frac{500}{1000} = 0,5\,kg$  
$\rho = \frac {0,5}{0,0005} = 1000\,kg/m^3$  
**Interpreta√ß√£o:** Essa √© a densidade da √°gua a $4^\circ C$.

---

**Exemplo 2: C√°lculo do peso espec√≠fico**
> Qual o peso espec√≠fico de um √≥leo cuja densidade √© $900\,kg/m^3$?

$\gamma = \rho g = 900 \times 9,81 = 8829\,N/m^3$

---

**Exemplo 3: Viscosidade cinem√°tica**
> Um fluido tem $\mu = 1,2 \times 10^{-3}\,Pa \cdot s$ e $\rho = 1200\,kg/m^3$. Qual sua viscosidade cinem√°tica?

$\nu = \frac{\mu}{\rho} = \frac{1,2 \times 10^{-3}}{1200} = 1,0 \times 10^{-6}\,m^2/s$

---

**Exemplo 4: Press√£o**
> Uma for√ßa de $500\,N$ √© aplicada perpendicularmente a uma √°rea de $0,25\,m^2$. Qual √© a press√£o?

$P = \frac{F}{A} = \frac{500}{0,25} = 2000\,Pa$
""")

    elif cap == "Cap√≠tulo 2 ‚Äì Est√°tica dos Fluidos":
        st.subheader("Cap√≠tulo 2 ‚Äì Est√°tica dos Fluidos")
        st.markdown(r"""
### Press√£o em um fluido em repouso
- **Press√£o em um ponto:** Igual em todas as dire√ß√µes no fluido parado.

- **Varia√ß√£o da press√£o com a profundidade:**
  $$
  \Delta P = \rho g \Delta h
  $$
  Onde:
  - $\Delta P$ = varia√ß√£o de press√£o ($Pa$)
  - $\rho$ = densidade ($kg/m^3$)
  - $g$ = gravidade ($m/s^2$)
  - $\Delta h$ = diferen√ßa de profundidade ($m$)
  - **Significado:** A press√£o aumenta com a profundidade em l√≠quidos.

### Manometria
- **Press√£o manom√©trica:**
  $$
  P_{man} = P_{abs} - P_{atm}
  $$
  Onde:
  - $P_{man}$ = press√£o manom√©trica
  - $P_{abs}$ = press√£o absoluta
  - $P_{atm}$ = press√£o atmosf√©rica

### Empuxo ‚Äì Princ√≠pio de Arquimedes
- **Empuxo ($E$):**
  $$
  E = \rho_{fluido} \cdot V_{deslocado} \cdot g
  $$
  Onde:
  - $E$ = for√ßa de empuxo ($N$)
  - $\rho_{fluido}$ = densidade do fluido ($kg/m^3$)
  - $V_{deslocado}$ = volume do fluido deslocado pelo corpo ($m^3$)
  - $g$ = gravidade ($m/s^2$)

- **Princ√≠pio de Arquimedes:** O empuxo sobre o corpo imerso √© igual ao peso do fluido deslocado.

---

### Exemplos Pr√°ticos

**Exemplo 1: Varia√ß√£o de press√£o com profundidade**
> Qual a press√£o no fundo de um tanque de √°gua de $5\,m$ de profundidade? (Considere $\rho_{agua}=1000\,kg/m^3$ e $g=9,81\,m/s^2$)

$\Delta P = \rho g \Delta h = 1000 \times 9,81 \times 5 = 49\,050\,Pa$  
**Resposta:** A press√£o no fundo do tanque √© $49,050\,Pa$ acima da atmosf√©rica.

---

**Exemplo 2: Man√¥metro em U**
> Um man√¥metro em U cont√©m √°gua e merc√∫rio. A diferen√ßa de n√≠veis do merc√∫rio √© de $0,12\,m$. Calcule a diferen√ßa de press√£o.

$\Delta P = \Delta h \cdot (\rho_{Hg} - \rho_{agua}) \cdot g$  
$\rho_{Hg} = 13\,600\,kg/m^3$, $\rho_{agua} = 1000\,kg/m^3$  
$\Delta P = 0,12 \times (13\,600 - 1000) \times 9,81 = 14\,012\,Pa$

---

**Exemplo 3: Empuxo**
> Um bloco de madeira ($\rho=600\,kg/m^3$) de volume $0,02\,m^3$ est√° totalmente submerso em √°gua. Qual o empuxo sobre o bloco?

$E = \rho_{agua} \cdot V_{deslocado} \cdot g = 1000 \times 0,02 \times 9,81 = 196,2\,N$

---

**Exemplo 4: Estabilidade de corpos flutuantes**
> Um corpo flutua se a densidade do corpo √© menor que a do fluido. Um objeto com $\rho=800\,kg/m^3$ colocado na √°gua ($\rho=1000\,kg/m^3$) ir√° flutuar com parte submersa.

""")
        
    elif cap == "Cap√≠tulo 3 ‚Äì Din√¢mica dos Fluidos (Bernoulli)":
        st.subheader("Cap√≠tulo 3 ‚Äì Din√¢mica dos Fluidos (Equa√ß√£o de Bernoulli)")
        st.markdown(r"""
### Equa√ß√£o de Bernoulli (forma geral)
$$
P + \frac{1}{2}\rho U^2 + \rho g h = \text{constante}
$$
Onde:
- $P$ = press√£o est√°tica do fluido ($Pa$)
- $\rho$ = densidade ($kg/m^3$)
- $U$ = velocidade do escoamento ($m/s$)
- $h$ = altura em rela√ß√£o a um referencial ($m$)
- $g$ = acelera√ß√£o da gravidade ($m/s^2$)

#### Restri√ß√µes de uso:
- Fluido incompress√≠vel
- Escoamento permanente
- Sem perdas (sem atrito)

#### Aplica√ß√µes:
- Determina√ß√£o de velocidades e press√µes em diferentes pontos de tubula√ß√µes, bocais, Venturi, etc.

---

### Exemplos Pr√°ticos

**Exemplo 1: Escoamento horizontal**
> √Ågua escoa horizontalmente em um tubo onde a press√£o cai de $250\,kPa$ para $150\,kPa$. Se a velocidade inicial √© $2\,m/s$, qual a velocidade final? ($\rho=1000\,kg/m^3$)

$P_1 + \frac{1}{2}\rho U_1^2 = P_2 + \frac{1}{2}\rho U_2^2$  
$250\,000 + 0.5 \times 1000 \times 2^2 = 150\,000 + 0.5 \times 1000 \times U_2^2$  
$250\,000 + 2000 = 150\,000 + 500 U_2^2$  
$252\,000 - 150\,000 = 500 U_2^2$  
$102\,000 = 500 U_2^2$  
$U_2^2 = 204$  
$U_2 = 14,28\,m/s$

---

**Exemplo 2: Tubo vertical**
> √Ågua sobe $10\,m$ em um tubo estreito. Qual a diferen√ßa de press√£o necess√°ria para levantar a √°gua essa altura? ($\rho=1000\,kg/m^3$)

$\Delta P = \rho g \Delta h = 1000 \times 9,81 \times 10 = 98\,100\,Pa$

---

**Exemplo 3: Medidor de vaz√£o (tubo de Venturi)**
> Em um tubo Venturi, a √°rea da entrada √© $10\,cm^2$ e a do gargalo √© $2\,cm^2$. Se a velocidade na entrada √© $1\,m/s$, qual a velocidade no gargalo?

Pela continuidade: $A_1 U_1 = A_2 U_2$  
$0,001 \times 1 = 0,0002 \times U_2$  
$U_2 = 5\,m/s$

---

**Exemplo 4: Diferen√ßa de press√£o em um esguicho**
> Qual a press√£o necess√°ria para que a √°gua saia de um cano na velocidade de $10\,m/s$?

$\Delta P = \frac{1}{2}\rho U^2 = 0,5 \times 1000 \times 10^2 = 50\,000\,Pa$

""")

    elif cap == "Cap√≠tulo 8 ‚Äì Escoamento Viscoso em Condutos":
        st.subheader("Cap√≠tulo 8 ‚Äì Escoamento Viscoso em Condutos")
        st.markdown(r"""
### N√∫mero de Reynolds ($Re$)
$$
Re = \frac{\rho U D}{\mu}
$$
- $Re < 2300$: laminar
- $Re > 4000$: turbulento

### Perda de carga distribu√≠da (f√≥rmula de Darcy-Weisbach)
$$
h_f = f \frac{L}{D} \frac{U^2}{2g}
$$
- $f$: fator de atrito (diagrama de Moody)

### Perdas localizadas
$$
h_{local} = K \frac{U^2}{2g}
$$

---

### Exemplos Pr√°ticos

**Exemplo 1: N√∫mero de Reynolds**
> √Ågua ($\mu = 1,0 \times 10^{-3}\,Pa \cdot s$) escoa em um tubo de $D=0,05\,m$ a $U=2\,m/s$. Calcule o $Re$.

$\rho = 1000\,kg/m^3$  
$Re = \frac{1000 \times 2 \times 0,05}{1 \times 10^{-3}} = 100\,000$  
**Escoamento turbulento.**

---

**Exemplo 2: Perda de carga distribu√≠da**
> Em um tubo de $L=10\,m$, $D=0,05\,m$, $U=2\,m/s$, $f=0,03$, calcule $h_f$.

$h_f = 0,03 \times \frac{10}{0,05} \times \frac{2^2}{2 \times 9,81} = 0,03 \times 200 \times \frac{4}{19,62}$  
$= 6 \times 0,204 = 1,224\,m$

---

**Exemplo 3: Perda localizada**
> Se uma v√°lvula tem $K=2$, com $U=2\,m/s$, qual √© $h_{local}$?

$h_{local} = 2 \times \frac{2^2}{2 \times 9,81} = 2 \times \frac{4}{19,62} = 2 \times 0,204 = 0,408\,m$

---

**Exemplo 4: Vaz√£o volum√©trica**
> Se $U=2\,m/s$ e o tubo tem $D=0,05\,m$, qual √© a vaz√£o $Q$?

$A = \pi D^2 / 4 = 3,1416 \times 0,0025 / 4 = 0,00196\,m^2$  
$Q = A \times U = 0,00196 \times 2 = 0,00392\,m^3/s = 3,92\,L/s$

""")

elif choice == "Exerc√≠cios Resolvidos":
    st.header("üìù Exerc√≠cios Resolvidos")
    st.info("Aqui voc√™ poder√° ver as solu√ß√µes passo a passo dos exerc√≠cios da lista.")

    # Banco de quest√µes
    questoes = {
        "2.18": {
            "capitulo": 2,
            "enunciado": (
        "Admitindo que a press√£o atmosf√©rica √© igual a 101 kPa (abs), determine as alturas das colunas de fluido em bar√¥metros "
        "que cont√©m os seguintes fluidos:\n"
        "(a) merc√∫rio, (b) √°gua e (c) √°lcool et√≠lico.\n"
        "Calcule as alturas levando em considera√ß√£o a press√£o de vapor destes fluidos e compare com os valores obtidos desconsiderando a press√£o de vapor.\n"
        "Densidades: merc√∫rio = 13.600 kg/m¬≥, √°gua = 1000 kg/m¬≥, √°lcool = 789 kg/m¬≥.\n"
        "Press√£o de vapor a 20¬∞C: merc√∫rio = 0,17 Pa, √°gua = 2.340 Pa, √°lcool = 5.850 Pa.\n"
        "g = 9,81 m/s¬≤."
    ),
    "dica": (
        "Para bar√¥metros, use $P_{atm} = \\rho g h + P_{vap}$.\n"
        "Isolando a altura: $h = (P_{atm} - P_{vap})/(\\rho g)$.\n"
        "Resolva para cada fluido e compare com o c√°lculo desprezando $P_{vap}$."
    ),
    "resolucao": r"""
**Resolu√ß√£o passo a passo:**

1. **F√≥rmula geral:**
   $$
   P_{atm} = \rho g h + P_{vap} \implies h = \frac{P_{atm} - P_{vap}}{\rho g}
   $$

   Onde:
   - $P_{atm}$: press√£o atmosf√©rica (Pa)
   - $\rho$: densidade do fluido (kg/m¬≥)
   - $g$: gravidade (m/s¬≤)
   - $P_{vap}$: press√£o de vapor do fluido (Pa)
   - $h$: altura da coluna de fluido (m)

2. **Dados:**
   - $P_{atm} = 101\,000$ Pa
   - $g = 9,81$ m/s¬≤

   | Fluido   | $\rho$ (kg/m¬≥) | $P_{vap}$ (Pa) |
   |----------|---------------|---------------|
   | Merc√∫rio | 13.600        | 0,17          |
   | √Ågua     | 1.000         | 2.340         |
   | √Ålcool   | 789           | 5.850         |

3. **(a) Merc√∫rio**

   - **Com press√£o de vapor:**
     $$
     h = \frac{101\,000 - 0,17}{13\,600 \times 9,81} \approx \frac{100\,999,83}{133\,416} \approx 0,7574\,m = 75,74\,cm
     $$
   - **Sem press√£o de vapor:**
     $$
     h = \frac{101\,000}{13\,600 \times 9,81} \approx 0,7576\,m = 75,76\,cm
     $$
   - **Diferen√ßa √© desprez√≠vel.**

4. **(b) √Ågua**

   - **Com press√£o de vapor:**
     $$
     h = \frac{101\,000 - 2\,340}{1\,000 \times 9,81} = \frac{98\,660}{9\,810} \approx 10,06\,m
     $$
   - **Sem press√£o de vapor:**
     $$
     h = \frac{101\,000}{9\,810} \approx 10,29\,m
     $$
   - **A diferen√ßa devido ao vapor √© significativa (~23 cm).**

5. **(c) √Ålcool et√≠lico**

   - **Com press√£o de vapor:**
     $$
     h = \frac{101\,000 - 5\,850}{789 \times 9,81} = \frac{95\,150}{7\,736,09} \approx 12,30\,m
     $$
   - **Sem press√£o de vapor:**
     $$
     h = \frac{101\,000}{7\,736,09} \approx 13,06\,m
     $$
   - **A diferen√ßa √© significativa (~76 cm).**

> **Resumo dos s√≠mbolos:**  
> - $P_{atm}$: press√£o atmosf√©rica  
> - $\rho$: densidade do fluido  
> - $g$: acelera√ß√£o da gravidade  
> - $P_{vap}$: press√£o de vapor  
> - $h$: altura da coluna

**Conclus√£o:**  
A press√£o de vapor pode ser desprezada para o merc√∫rio, mas √© importante para l√≠quidos vol√°teis como √°gua e √°lcool.
""",
        "resposta": {
            "a": 0.7574,   # altura merc√∫rio (m), com press√£o de vapor
            "b": 10.06,    # altura √°gua (m), com press√£o de vapor
            "c": 12.30     # altura √°lcool (m), com press√£o de vapor
        },
        "tolerancia": {
            "a": 0.002,
            "b": 0.03,
            "c": 0.05
        },
        "unidade": "m",
    }
    }

    # Interface para sele√ß√£o de quest√µes
    questao_selecionada = st.selectbox(
        "Escolha uma quest√£o:",
        list(questoes.keys()),
        format_func=lambda x: f"Quest√£o {x} - Cap√≠tulo {questoes[x]['capitulo']}"
    )

    if questao_selecionada:
        questao = questoes[questao_selecionada]
        
        st.subheader(f"üìã Quest√£o {questao_selecionada}")
        
        # Enunciado
        st.markdown("**Enunciado:**")
        st.markdown(questao["enunciado"])
        
        # Dica (expans√≠vel)
        with st.expander("üí° Ver dica"):
            st.markdown(questao["dica"])
        
        # Resolu√ß√£o (expans√≠vel)
        with st.expander("üìù Ver resolu√ß√£o completa"):
            st.markdown(questao["resolucao"])

elif choice == "Sobre":
    st.header("‚ÑπÔ∏è Sobre o MecaTutorIA")
    st.markdown("""
    ### üéØ Objetivo
    O **MecaTutorIA** √© uma ferramenta educacional desenvolvida para auxiliar estudantes de Engenharia no aprendizado de **Mec√¢nica dos Fluidos**, baseada no livro **Munson (4¬™ Edi√ß√£o)**.

    ### üìö Conte√∫do
    - **Resumos dos Cap√≠tulos**: Conceitos fundamentais, f√≥rmulas e exemplos pr√°ticos
    - **Exerc√≠cios Resolvidos**: Solu√ß√µes passo a passo com explica√ß√µes detalhadas
    - **Tabelas de Propriedades**: Dados de fluidos para consulta r√°pida

    ### üîß Tecnologias
    - **Streamlit**: Interface web interativa
    - **Python**: Processamento e c√°lculos
    - **LaTeX**: Renderiza√ß√£o de f√≥rmulas matem√°ticas

    ### üë®‚Äçüíª Desenvolvido por
    [Seu Nome] - Estudante de Engenharia

    ### üìñ Refer√™ncia
    **Munson, B. R.; Young, D. F.; Okiishi, T. H.** *Fundamentos da Mec√¢nica dos Fluidos*. 4¬™ ed. S√£o Paulo: Edgard Bl√ºcher, 2004.

    ---
    *Vers√£o 1.0 - 2024*
    """)
